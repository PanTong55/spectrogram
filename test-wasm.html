<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>WASM åˆå§‹åŒ–æ¸¬è©¦</title>
</head>
<body>
    <h1>WASM åˆå§‹åŒ–æ¸¬è©¦</h1>
    <div id="output" style="white-space: pre; font-family: monospace; background: #f0f0f0; padding: 10px;"></div>

    <script type="module">
        const output = document.getElementById('output');
        
        function log(msg) {
            output.textContent += msg + '\n';
            console.log(msg);
        }

        async function testWasm() {
            log('ğŸ” é–‹å§‹æ¸¬è©¦ WASM åˆå§‹åŒ–...\n');

            try {
                // å°å…¥ä¸¦åˆå§‹åŒ– WASM
                log('ğŸ“¦ æ­£åœ¨å°å…¥ WASM æ¨¡å¡Š...');
                const wasmModule = await import('./modules/spectrogram_wasm.js');
                log('âœ… WASM æ¨¡å¡Šå·²å°å…¥');

                // æª¢æŸ¥ WaveformEngine
                if (wasmModule.WaveformEngine) {
                    log('âœ… WaveformEngine é¡å·²æ‰¾åˆ°');
                    
                    // å‰µå»ºå¯¦ä¾‹
                    const engine = new wasmModule.WaveformEngine();
                    log('âœ… WaveformEngine å¯¦ä¾‹å·²å‰µå»º');
                    
                    // æ¸¬è©¦ resize
                    engine.resize(2);
                    log('âœ… resize(2) èª¿ç”¨æˆåŠŸ');
                    
                    // æ¸¬è©¦ load_channel
                    const testData = new Float32Array([0.1, 0.2, 0.3, 0.4, 0.5]);
                    engine.load_channel(0, testData);
                    log('âœ… load_channel(0, ...) èª¿ç”¨æˆåŠŸ');
                    
                    // æ¸¬è©¦ get_peaks_in_range
                    const peaks = engine.get_peaks_in_range(0, 0, 5, 2);
                    log(`âœ… get_peaks_in_range(0, 0, 5, 2) è¿”å› ${peaks.length} å€‹å³°å€¼`);
                    log(`   å³°å€¼: ${Array.from(peaks).join(', ')}`);
                    
                    log('\nâœ… æ‰€æœ‰ WASM åŠŸèƒ½æ¸¬è©¦é€šéï¼');
                } else {
                    log('âŒ WaveformEngine é¡æœªæ‰¾åˆ°åœ¨ WASM æ¨¡å¡Šä¸­');
                    log('å¯ç”¨çš„å°å‡º:', Object.keys(wasmModule));
                }

                // æš´éœ²åˆ°å…¨å±€è®Šé‡
                globalThis._spectrogramWasm = wasmModule;
                log('âœ… WASM æ¨¡å¡Šå·²æš´éœ²åˆ° globalThis._spectrogramWasm');

            } catch (e) {
                log(`âŒ éŒ¯èª¤: ${e.message}`);
                log(e.stack);
            }
        }

        testWasm();
    </script>
</body>
</html>
