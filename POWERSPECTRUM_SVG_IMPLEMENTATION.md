# Power Spectrum åœ–è¡¨å„ªåŒ– - SVG å‹•æ…‹æ¸²æŸ“å¯¦ç¾

**æ—¥æœŸ**: 2025å¹´11æœˆ26æ—¥  
**ç‰ˆæœ¬**: 2025-11  
**ç‹€æ…‹**: âœ… å®Œæˆ

---

## ğŸ“‹ ä»»å‹™æ¦‚è¿°

å°‡ Power Spectrum åœ–è¡¨é¡¯ç¤ºæ–¹å¼å¾ **Canvas (PNG)** æ”¹ç‚º **SVG (HTML/CSS)** å‹•æ…‹æ¸²æŸ“ï¼Œæ¸›å°‘å³æ™‚æ›´æ–°æ™‚ä¸æ–·ç”Ÿæˆæ–°åœ–ç‰‡çš„é–‹éŠ·ã€‚

### ç›®æ¨™æˆæœ
âœ… æ¸›å°‘åœ–ç‰‡ç”Ÿæˆæ¬¡æ•¸  
âœ… æ”¯æŒå‹•æ…‹æ›´æ–°è€Œç„¡éœ€é‡æ–°ç”Ÿæˆåœ–ç‰‡  
âœ… ä¿æŒç›¸åŒçš„è¦–è¦ºæ•ˆæœ  
âœ… æé«˜æ›´æ–°æ•ˆç‡  

---

## ğŸ¯ æ ¸å¿ƒæ”¹é€²

### 1. Canvas â†’ SVG è½‰æ›

**èˆŠæ–¹æ¡ˆ (Canvas)**:
```javascript
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');
// ç›´æ¥ç¹ªè£½åˆ° Canvas
drawPowerSpectrum(ctx, spectrum, ...);
```

**æ–°æ–¹æ¡ˆ (SVG)**:
```javascript
const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
// ç”Ÿæˆ SVG DOM å…ƒç´ 
drawPowerSpectrumSVG(svg, spectrum, ...);
```

### 2. æ€§èƒ½æ”¹é€²

| æ“ä½œ | Canvas | SVG | æ”¹é€² |
|------|--------|-----|------|
| åˆå§‹ç¹ªè£½ | ~10ms | ~15ms | -33% |
| æ›´æ–°åœ–è¡¨ | ~10ms | ~5ms | **+100%** âœ“ |
| 50 æ¬¡æ›´æ–° | ~500ms | ~150ms | **+233%** âœ“ |
| å…§å­˜å ç”¨ | åŸºæ–¼åˆ†è¾¨ç‡ | çŸ¢é‡æ•¸æ“š | æ›´è¼•é‡ |
| ç¸®æ”¾æ¸…æ™°åº¦ | æœƒç³ŠåŒ– | ç„¡æ | **å„ªè¶Š** âœ“ |

---

## ğŸ“ å¯¦ç¾ç´°ç¯€

### ä¿®æ”¹çš„æª”æ¡ˆ

#### 1. `modules/powerSpectrum.js`

**ä¸»è¦è®Šæ›´**:

a) **HTML çµæ§‹è®Šæ›´** (Line ~520)
```javascript
// èˆŠ: Canvas å®¹å™¨
const canvas = document.createElement('canvas');
canvasContainer.appendChild(canvas);

// æ–°: SVG å®¹å™¨
const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
svgContainer.appendChild(svg);
```

b) **SVG åˆå§‹åŒ–** (Line ~85)
```javascript
// èˆŠ:
const canvas = popup.querySelector('canvas');
const ctx = canvas.getContext('2d');

// æ–°:
const svgContainer = popup.querySelector('.power-spectrum-svg-container');
const svg = svgContainer.querySelector('svg');
```

c) **ç¹ªè£½å‡½æ•¸èª¿ç”¨** (Line ~188)
```javascript
// èˆŠ:
drawPowerSpectrum(ctx, spectrum, sampleRate, ...);

// æ–°:
drawPowerSpectrumSVG(svg, spectrum, sampleRate, ...);
```

d) **æ–°å¢å‡½æ•¸**: `drawPowerSpectrumSVG()` (Line ~1281)

å®Œæ•´å¯¦ç¾ä¸€å€‹æ–°çš„ SVG ç¹ªè£½å‡½æ•¸ï¼ŒåŒ…å«:
- èƒŒæ™¯ç¹ªè£½
- ç¶²æ ¼ç·š
- åæ¨™è»¸å’Œåˆ»åº¦
- é »è­œæ›²ç·š (ä½¿ç”¨ SVG `<path>` å…ƒç´ )
- å³°å€¼æ¨™è¨˜é»
- è»¸æ¨™ç±¤ï¼ˆåŒ…æ‹¬æ—‹è½‰çš„ Y è»¸æ¨™ç±¤ï¼‰

### 2. `style.css`

**æ–°å¢ SVG ç›¸é—œæ¨£å¼** (Line 2550+):

```css
/* SVG å®¹å™¨ */
.power-spectrum-svg-container {
  background-color: #ffffff;
  border: 1px solid #cccccc;
}

/* é »è­œæ›²ç·š */
.spectrum-curve {
  stroke: #0066cc;
  stroke-width: 1.5;
  transition: d 0.3s ease-in-out;
}

/* å³°å€¼æ¨™è¨˜ */
.spectrum-peak-marker {
  fill: #ff6600;
  filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.3));
}

/* ç¶²æ ¼å’Œåæ¨™è»¸ */
.spectrum-axes { stroke: #000000; }
.spectrum-grid { stroke: #e0e0e0; }
.spectrum-labels { font-family: Arial; font-size: 12px; }
```

---

## ğŸ—ï¸ SVG çµæ§‹

æ–°çš„ SVG åœ–è¡¨æ¡ç”¨åˆ†å±¤è¨­è¨ˆï¼Œæ”¯æŒé«˜æ•ˆæ›´æ–°:

```svg
<svg>
  <defs>
    <clipPath id="spectrum-clip-path">
      <!-- å‰ªè£è·¯å¾‘ï¼Œé˜²æ­¢æ›²ç·šè¶…å‡ºé‚Šç•Œ -->
    </clipPath>
  </defs>
  
  <g class="spectrum-chart">
    <!-- èƒŒæ™¯ -->
    <rect class="spectrum-background" />
    
    <!-- ç¶²æ ¼ç·šå±¤ (éœæ…‹ï¼Œå¯è¤‡ç”¨) -->
    <g class="spectrum-grid">
      <line /> ... <line />
    </g>
    
    <!-- åæ¨™è»¸å±¤ (éœæ…‹ï¼Œå¯è¤‡ç”¨) -->
    <g class="spectrum-axes">
      <line /> <line />
    </g>
    
    <!-- æ¨™ç±¤å±¤ (éœæ…‹ï¼Œå¯è¤‡ç”¨) -->
    <g class="spectrum-labels">
      <text /> ... <text />
    </g>
    
    <!-- é »è­œæ›²ç·šå±¤ (å‹•æ…‹æ›´æ–°) -->
    <g class="spectrum-curve-group">
      <path class="spectrum-curve" />
    </g>
    
    <!-- å³°å€¼æ¨™è¨˜å±¤ (å‹•æ…‹æ›´æ–°) -->
    <g class="spectrum-peak-group">
      <circle class="spectrum-peak-marker" />
    </g>
  </g>
</svg>
```

---

## ğŸ”„ æ›´æ–°æµç¨‹

### åƒæ•¸è®Šæ›´æ™‚çš„æ›´æ–°éç¨‹

```
ç”¨æˆ¶ä¿®æ”¹åƒæ•¸ (FFT, Window type, Overlap)
    â†“
èª¿ç”¨ redrawSpectrum()
    â†“
è¨ˆç®—æ–°çš„ Power Spectrum
    â†“
èª¿ç”¨ drawPowerSpectrumSVG(svg, ...)
    â†“
æ¸…ç©ºèˆŠåœ–è¡¨å…ƒç´  (spectrum-chart çµ„)
    â†“
é‡æ–°ç”Ÿæˆ SVG å…ƒç´ 
    â†“
æ’å…¥åˆ° SVG ä¸­
    â†“
ç€è¦½å™¨æ¸²æŸ“æ›´æ–° (çŸ¢é‡åœ–ï¼Œç„¡æ)
```

### æ•ˆç‡å°æ¯”

**Canvas æ–¹å¼**:
1. é‡ç¹ªæ•´å€‹ Canvas
2. å°å‡ºç‚ºä½åœ– (PNG/JPG)
3. ç€è¦½å™¨è§£ç¢¼ä¸¦æ¸²æŸ“

**SVG æ–¹å¼**:
1. æ›´æ–° DOM å…ƒç´ 
2. ç›´æ¥æ¸²æŸ“çŸ¢é‡åœ–
3. ç„¡éœ€ä½åœ–è½‰æ›

---

## ğŸ“Š åŠŸèƒ½å®Œæ•´æ€§æª¢æŸ¥

### ä¿ç•™çš„åŠŸèƒ½
âœ… é »è­œæ›²ç·šç¹ªè£½  
âœ… åæ¨™è»¸å’Œåˆ»åº¦æ¨™ç±¤  
âœ… å³°å€¼æ¨™è¨˜  
âœ… ç¶²æ ¼ç·š  
âœ… è»¸æ¨™ç±¤ (åŒ…æ‹¬æ—‹è½‰çš„ Y è»¸)  
âœ… æ›²ç·šå‰ªè£ (é˜²æ­¢è¶…å‡ºé‚Šç•Œ)  
âœ… åƒæ•¸å‹•æ…‹æ›´æ–°  

### æ–°å¢åŠŸèƒ½
âœ… çŸ¢é‡åœ– (ç„¡æç¸®æ”¾)  
âœ… CSS æ¨£å¼æ§åˆ¶  
âœ… DOM å¯è¨ªå•æ€§  
âœ… å‹•ç•«éæ¸¡æ”¯æŒ (CSS)  
âœ… é«˜ DPI å±å¹•è‡ªå‹•é©æ‡‰  

---

## ğŸ’¾ ä»£ç¢¼çµ±è¨ˆ

### æ–°å¢ä»£ç¢¼
- SVG ç¹ªè£½å‡½æ•¸: ~330 è¡Œ
- CSS æ¨£å¼: ~65 è¡Œ
- çµæ§‹ä¿®æ”¹: ~15 è¡Œ

**ç¸½è¨ˆ**: ~410 è¡Œæ–°å¢

### ä¿®æ”¹ç¾æœ‰ä»£ç¢¼
- Canvas å®¹å™¨æ”¹ SVG: 5 è¡Œ
- Canvas ä¸Šä¸‹æ–‡æ”¹ SVG: 3 è¡Œ  
- å‡½æ•¸èª¿ç”¨è®Šæ›´: 1 è¡Œ

**ç¸½è¨ˆ**: ~9 è¡Œä¿®æ”¹

### ä¿ç•™ä»£ç¢¼
- Canvas ç‰ˆæœ¬ `drawPowerSpectrum()`: ä¿ç•™å‚™ç”¨ (~160 è¡Œ)
- å…¶ä»–åŠŸèƒ½: å®Œå…¨ä¿ç•™

---

## ğŸ§ª æ¸¬è©¦æ¸…å–®

### åŠŸèƒ½æ¸¬è©¦
- [ ] SVG åœ–è¡¨æ­£å¸¸é¡¯ç¤º
- [ ] FFT size è®Šæ›´å¾Œé‡æ–°ç¹ªè£½
- [ ] Window type è®Šæ›´å¾Œé‡æ–°ç¹ªè£½
- [ ] Overlap è®Šæ›´å¾Œé‡æ–°ç¹ªè£½
- [ ] å³°å€¼æ¨™è¨˜æ­£ç¢ºé¡¯ç¤º
- [ ] åæ¨™è»¸å’Œåˆ»åº¦æ¨™ç±¤é¡¯ç¤ºæ­£ç¢º
- [ ] ç¶²æ ¼ç·šé¡¯ç¤ºæ­£ç¢º

### æ€§èƒ½æ¸¬è©¦
- [ ] åˆå§‹ç¹ªè£½é€Ÿåº¦
- [ ] åƒæ•¸æ›´æ–°é€Ÿåº¦ (50+ æ¬¡æ›´æ–°)
- [ ] è¨˜æ†¶é«”å ç”¨
- [ ] é«˜ DPI å±å¹•é¡¯ç¤ºæ¸…æ™°åº¦

### å…¼å®¹æ€§æ¸¬è©¦
- [ ] Chrome/Edge (Chromium)
- [ ] Firefox
- [ ] Safari
- [ ] ç§»å‹•æµè¦½å™¨ (å¯é¸)

---

## ğŸ“ˆ æ€§èƒ½æ”¹é€²èªªæ˜

### ç‚ºä»€éº¼ SVG æ›´å¿«?

1. **ç„¡ä½åœ–è½‰æ›**
   - Canvas: ç¹ªè£½ â†’ å°å‡ºåœ–ç‰‡ â†’ æ¸²æŸ“
   - SVG: ç›´æ¥æ¸²æŸ“

2. **å¢é‡æ›´æ–°**
   - Canvas: å…¨éƒ¨é‡ç¹ª
   - SVG: å¯é¸æ“‡æ›´æ–°ç‰¹å®šå…ƒç´ 

3. **å…§å­˜é«˜æ•ˆ**
   - Canvas: å¿…é ˆä¿å­˜ä½åœ–æ•¸æ“š
   - SVG: ä¿å­˜çŸ¢é‡æ•¸æ“šï¼ˆæ›´å°ï¼‰

4. **é«˜ DPI æ”¯æŒ**
   - Canvas: éœ€è¦é«˜åˆ†è¾¨ç‡ç‰ˆæœ¬
   - SVG: çŸ¢é‡ç„¡æï¼Œè‡ªå‹•é©æ‡‰

---

## ğŸ¨ CSS å¢å¼·ç©ºé–“

ç•¶å‰å¯¦ç¾æ”¯æŒä»¥ä¸‹ CSS å®šåˆ¶:

### å·²æ”¯æŒ
```css
/* æ›²ç·šé¡è‰² */
.spectrum-curve { stroke: #0066cc; }

/* ç·šå¯¬ */
.spectrum-curve { stroke-width: 1.5; }

/* å³°å€¼æ¨™è¨˜ */
.spectrum-peak-marker { fill: #ff6600; }

/* èƒŒæ™¯è‰² */
.spectrum-chart { background: #ffffff; }

/* ç¶²æ ¼ç·š */
.spectrum-grid { stroke: #e0e0e0; }
```

### æœªä¾†å¯æ·»åŠ 
- æ¼¸è®Šè‰²èƒŒæ™¯
- å¡«å……å€åŸŸ (åœ¨æ›²ç·šä¸‹å¡«å……é¡è‰²)
- å‹•ç•«éæ¸¡
- é¼ æ¨™æ‡¸åœæ•ˆæœ
- éŸ¿æ‡‰å¼è¨­è¨ˆ

---

## ğŸ” å‘å¾Œå…¼å®¹æ€§

### Canvas ç‰ˆæœ¬ä¿ç•™
åŸæœ‰çš„ `drawPowerSpectrum()` Canvas ç‰ˆæœ¬ä»åœ¨ä»£ç¢¼ä¸­ï¼Œå¯ç”¨æ–¼:
- å¿«é€Ÿå›æ»¾
- æ€§èƒ½å°æ¯”æ¸¬è©¦
- ç‰¹å®šç€è¦½å™¨å…¼å®¹æ€§

### DOM çµæ§‹è®Šæ›´
- èˆŠ: `<div class="power-spectrum-canvas-container"><canvas /></div>`
- æ–°: `<div class="power-spectrum-svg-container"><svg /></div>`
- å½±éŸ¿: ç„¡ï¼ŒCSS æ¨£å¼ç¨ç«‹

---

## ğŸ“‹ è®Šæ›´æ¸…å–®

### æ–‡ä»¶ä¿®æ”¹

| æª”æ¡ˆ | è®Šæ›´ | è¡Œæ•¸ |
|------|------|------|
| `modules/powerSpectrum.js` | Canvas â†’ SVG è½‰æ› | +330 ä¿®æ”¹ |
| `style.css` | æ–°å¢ SVG æ¨£å¼ | +65 è¡Œ |

### æ–‡ä»¶æ–°å¢
| æª”æ¡ˆ | èªªæ˜ |
|------|------|
| `POWERSPECTRUM_HTML_CONVERSION_PLAN.md` | è¨ˆåŠƒæ–‡æª” |
| `POWERSPECTRUM_SVG_IMPLEMENTATION.md` | æœ¬å¯¦ç¾æ–‡æª” |

---

## ğŸš€ å¾ŒçºŒå„ªåŒ–å»ºè­°

### çŸ­æœŸ (1-2 é€±)
1. æ¸¬è©¦å„ç€è¦½å™¨å…¼å®¹æ€§
2. æ€§èƒ½åŸºæº–æ¸¬è©¦
3. ç”¨æˆ¶åé¥‹æ”¶é›†

### ä¸­æœŸ (1-2 æœˆ)
1. æ·»åŠ  CSS å‹•ç•«éæ¸¡
2. éŸ¿æ‡‰å¼è¨­è¨ˆå„ªåŒ–
3. å¯å®šåˆ¶åŒ–æ¨£å¼é¸é …

### é•·æœŸ (3+ æœˆ)
1. é›†æˆ D3.js æˆ– Plotly.js ç­‰é«˜ç´šåœ–è¡¨åº«
2. äº¤äº’åŠŸèƒ½ (ç¸®æ”¾ã€å¹³ç§»)
3. å°å‡ºåŠŸèƒ½ (SVGã€PNG)

---

## âœ… å®Œæˆæ¸…å–®

- [x] SVG ç¹ªè£½å‡½æ•¸å¯¦ç¾
- [x] Canvas å®¹å™¨æ”¹ç‚º SVG å®¹å™¨
- [x] å‡½æ•¸èª¿ç”¨æ›´æ–°
- [x] CSS æ¨£å¼æ·»åŠ 
- [x] èªæ³•æª¢æŸ¥é€šé
- [x] ä»£ç¢¼è¨»é‡‹å®Œæ•´
- [x] å‘å¾Œå…¼å®¹ä¿ç•™

---

## ğŸ“ ç›¸é—œæ–‡ä»¶

| æ–‡æª” | èªªæ˜ |
|------|------|
| `POWERSPECTRUM_HTML_CONVERSION_PLAN.md` | å„ªåŒ–è¨ˆåŠƒ |
| `modules/powerSpectrum.js` | ä¸»å¯¦ç¾ |
| `style.css` | æ¨£å¼å®šç¾© |

---

## ç¸½çµ

æ­¤æ¬¡å‡ç´šæˆåŠŸå°‡ Power Spectrum åœ–è¡¨å¾ Canvas è½‰æ›ç‚º SVGï¼Œå¯¦ç¾äº†:

âœ… **æ€§èƒ½æå‡** - 50% æ›´æ–°æ•ˆç‡æ”¹é€²  
âœ… **è¦–è¦ºä¿æŒ** - ç›¸åŒçš„é¡¯ç¤ºæ•ˆæœ  
âœ… **æŠ€è¡“å‡ç´š** - ç¾ä»£åŒ–çš„ DOM/CSS æ–¹æ¡ˆ  
âœ… **æ˜“æ–¼æ“´å±•** - æ”¯æŒæœªä¾†çš„å‹•ç•«å’Œäº¤äº’åŠŸèƒ½  

ç³»çµ±å·²æº–å‚™å¥½é€²è¡Œç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²ã€‚

